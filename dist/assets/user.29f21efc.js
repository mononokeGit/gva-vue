/*! 
 Build based on gin-vue-admin 
 Time : 1678795244000 */
import{r as e,H as a,b as l,o as t,c as i,e as o,d as s,w as u,h as r,m as d,f as n,a9 as m,P as p,aa as c,i as v,ab as g,ac as h,ad as y,A as f,ae as b}from"./index.a10c697d.js";import{g as w}from"./authority.63d62beb.js";import{C as I}from"./index.46179dcf.js";import{_ as V}from"./index.acd7945a.js";import{W as k}from"./warningBar.e58a79fd.js";import"./common.3c7202de.js";const _={class:"gva-table-box"},N={class:"gva-btn-list"},z=s("p",null,"确定要删除此用户吗",-1),C={style:{"text-align":"right","margin-top":"8px"}},x={class:"gva-pagination"},U={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},D=["src"],S={key:1,class:"header-img-box"},j={class:"dialog-footer"},O={name:"User"},q=Object.assign(O,{setup(O){const q=e("/api/"),J=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};J(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},T=e(1),B=e(0),P=e(10),A=e([]),E=e=>{P.value=e,R()},F=e=>{T.value=e,R()},R=async()=>{const e=await m({page:T.value,pageSize:P.value});0===e.code&&(A.value=e.data.list,B.value=e.data.total,T.value=e.data.page,P.value=e.data.pageSize)};a((()=>A.value),(()=>{$()}));(async()=>{R();const e=await w({page:1,pageSize:999});G(e.data.list)})();const $=()=>{A.value&&A.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},H=e(null),W=()=>{H.value.open()},Z=e([]),G=e=>{Z.value=[],J(e,Z.value)},K=e({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),L=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),M=e(null),Q=async()=>{K.value.authorityId=K.value.authorityIds[0],M.value.validate((async e=>{if(e){const e={...K.value};if("add"===ee.value){0===(await h(e)).code&&(v({type:"success",message:"创建成功"}),await R(),Y())}if("edit"===ee.value){const a=await y(e);console.log(e),0===a.code&&(v({type:"success",message:"编辑成功"}),await R(),Y())}}}))},X=e(!1),Y=()=>{M.value.resetFields(),K.value.headerImg="",K.value.authorityIds=[],X.value=!1},ee=e("add"),ae=()=>{ee.value="add",X.value=!0},le={},te=async(e,a,l)=>{if(a)return void(l||(le[e.ID]=[...e.authorityIds]));await f();0===(await b({ID:e.ID,authorityIds:e.authorityIds})).code?v({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...le[e.ID]],delete le[e.ID])};return(e,a)=>{const m=l("el-button"),h=l("el-table-column"),b=l("el-cascader"),w=l("el-switch"),O=l("el-popover"),J=l("el-table"),$=l("el-pagination"),G=l("el-input"),le=l("el-form-item"),ie=l("el-form"),oe=l("el-dialog");return t(),i("div",null,[o(k,{title:"注：右上角头像下拉可切换角色"}),s("div",_,[s("div",N,[o(m,{size:"small",type:"primary",icon:"plus",onClick:ae},{default:u((()=>[r("新增用户")])),_:1})]),o(J,{data:A.value,"row-key":"ID"},{default:u((()=>[o(h,{align:"left",label:"头像","min-width":"75"},{default:u((e=>[o(I,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),o(h,{align:"left",label:"ID","min-width":"50",prop:"ID"}),o(h,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),o(h,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),o(h,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),o(h,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),o(h,{align:"left",label:"用户角色","min-width":"200"},{default:u((e=>[o(b,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:Z.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{te(e.row,a,0)},onRemoveTag:a=>{te(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),o(h,{align:"left",label:"启用","min-width":"150"},{default:u((e=>[o(w,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{K.value=JSON.parse(JSON.stringify(e)),await f();const a={...K.value};0===(await y(a)).code&&(v({type:"success",message:(2===a.enable?"禁用":"启用")+"成功"}),await R(),K.value.headerImg="",K.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),o(h,{label:"操作","min-width":"250",fixed:"right"},{default:u((e=>[o(O,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top",width:"160"},{reference:u((()=>[o(m,{type:"primary",link:"",icon:"delete",size:"small"},{default:u((()=>[r("删除")])),_:1})])),default:u((()=>[z,s("div",C,[o(m,{size:"small",type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:u((()=>[r("取消")])),_:2},1032,["onClick"]),o(m,{type:"primary",size:"small",onClick:a=>(async e=>{0===(await g({id:e.ID})).code&&(v.success("删除成功"),e.visible=!1,await R())})(e.row)},{default:u((()=>[r("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"]),o(m,{type:"primary",link:"",icon:"edit",size:"small",onClick:a=>{return l=e.row,ee.value="edit",K.value=JSON.parse(JSON.stringify(l)),void(X.value=!0);var l}},{default:u((()=>[r("编辑")])),_:2},1032,["onClick"]),o(m,{type:"primary",link:"",icon:"magic-stick",size:"small",onClick:a=>{return l=e.row,void p.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await c({ID:l.ID});0===e.code?v({type:"success",message:e.msg}):v({type:"error",message:e.msg})}));var l}},{default:u((()=>[r("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),s("div",x,[o($,{"current-page":T.value,"page-size":P.value,"page-sizes":[10,30,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:F,onSizeChange:E},null,8,["current-page","page-size","total"])])]),o(oe,{modelValue:X.value,"onUpdate:modelValue":a[7]||(a[7]=e=>X.value=e),"custom-class":"user-dialog",title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:u((()=>[s("div",j,[o(m,{size:"small",onClick:Y},{default:u((()=>[r("取 消")])),_:1}),o(m,{size:"small",type:"primary",onClick:Q},{default:u((()=>[r("确 定")])),_:1})])])),default:u((()=>[s("div",U,[o(ie,{ref_key:"userForm",ref:M,rules:L.value,model:K.value,"label-width":"80px"},{default:u((()=>["add"===ee.value?(t(),d(le,{key:0,label:"用户名",prop:"userName"},{default:u((()=>[o(G,{modelValue:K.value.userName,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value.userName=e)},null,8,["modelValue"])])),_:1})):n("",!0),"add"===ee.value?(t(),d(le,{key:1,label:"密码",prop:"password"},{default:u((()=>[o(G,{modelValue:K.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value.password=e)},null,8,["modelValue"])])),_:1})):n("",!0),o(le,{label:"昵称",prop:"nickName"},{default:u((()=>[o(G,{modelValue:K.value.nickName,"onUpdate:modelValue":a[2]||(a[2]=e=>K.value.nickName=e)},null,8,["modelValue"])])),_:1}),o(le,{label:"手机号",prop:"phone"},{default:u((()=>[o(G,{modelValue:K.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>K.value.phone=e)},null,8,["modelValue"])])),_:1}),o(le,{label:"邮箱",prop:"email"},{default:u((()=>[o(G,{modelValue:K.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>K.value.email=e)},null,8,["modelValue"])])),_:1}),o(le,{label:"用户角色",prop:"authorityId"},{default:u((()=>[o(b,{modelValue:K.value.authorityIds,"onUpdate:modelValue":a[5]||(a[5]=e=>K.value.authorityIds=e),style:{width:"100%"},options:Z.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),o(le,{label:"启用",prop:"disabled"},{default:u((()=>[o(w,{modelValue:K.value.enable,"onUpdate:modelValue":a[6]||(a[6]=e=>K.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),o(le,{label:"头像","label-width":"80px"},{default:u((()=>[s("div",{style:{display:"inline-block"},onClick:W},[K.value.headerImg?(t(),i("img",{key:0,alt:"头像",class:"header-img-box",src:K.value.headerImg&&"http"!==K.value.headerImg.slice(0,4)?q.value+K.value.headerImg:K.value.headerImg},null,8,D)):(t(),i("div",S,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),o(V,{ref_key:"chooseImg",ref:H,target:K.value,"target-key":"headerImg"},null,8,["target"])])}}});export{q as default};
