/*! 
 Build based on gin-vue-admin 
 Time : 1678795244000 */
import e from"./fieldDialog.42d75067.js";import l from"./previewCodeDialg.c68b55e3.js";import{a,b as t,t as u,c as d}from"./stringFun.1a90c7e7.js";import{p as o,c as i,g as s,a as n,b as m,d as r,e as p}from"./autoCode.d4a8ebb7.js";import{u as c}from"./dictionary.f99b60b8.js";import{_ as v,r as f,R as b,u as g,a as y,H as N,b as V,o as _,c as h,e as k,d as w,w as T,h as x,F as C,t as U,m as B,v as D,f as E,i as z,ag as S,p as F,q as L,ah as q}from"./index.a10c697d.js";import{W as j}from"./warningBar.e58a79fd.js";import"./sysDictionary.5409d8a6.js";const J=e=>(F("data-v-04b94108"),e=e(),L(),e),O={class:"gva-search-box"},A={style:{fontSize:"16px",paddingLeft:"20px"}},R={style:{float:"right",color:"#8492a6","font-size":"13px"}},I={class:"gva-search-box"},M={style:{float:"right",color:"#8492a6","font-size":"13px"}},W=J((()=>w("div",null," 自动创建API ",-1))),P=J((()=>w("div",null," 自动移动文件 ",-1))),$={class:"gva-table-box"},X={class:"gva-btn-list"},G=J((()=>w("p",null,"确定删除吗？",-1))),K={style:{"text-align":"right","margin-top":"8px"}},H={class:"gva-btn-list justify-content-flex-end auto-btn-list"},Q={class:"dialog-footer"},Y={class:"previewCodeTool"},Z=J((()=>w("p",null,"操作栏：",-1))),ee={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},le={name:"AutoCode"},ae=v(Object.assign(le,{setup(v){const F=f([{label:"字符串",value:"string"},{label:"整型",value:"int"},{label:"布尔值",value:"bool"},{label:"浮点型",value:"float64"},{label:"时间",value:"time.Time"},{label:"枚举",value:"enum"}]),L=f([{label:"=",value:"="},{label:"<>",value:"<>"},{label:">",value:">"},{label:"<",value:"<"},{label:"LIKE",value:"LIKE"},{label:"BETWEEN",value:"BETWEEN"},{label:"NOT BETWEEN",value:"NOT BETWEEN"}]),J={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",require:!1,sort:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""},le=b(),ae=g(),te=y([]),ue=f({}),de=f({businessDB:"",dbName:"",tableName:""}),oe=f([]),ie=f(""),se=f({}),ne=f({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",businessDB:"",autoCreateApiToSql:!0,autoMoveFile:!0,autoCreateResource:!1,fields:[]}),me=f({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),re=f({}),pe=f({}),ce=f(!1),ve=f(!1),fe=f(null),be=()=>{fe.value.selectText()},ge=()=>{fe.value.copy()},ye=e=>{ce.value=!0,e?(ie.value="edit",pe.value=JSON.parse(JSON.stringify(e)),re.value=e):(ie.value="add",re.value=JSON.parse(JSON.stringify(J)))},Ne=q(),Ve=()=>{Ne.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;re.value.fieldName=t(re.value.fieldName),"add"===ie.value&&ne.value.fields.push(re.value),ce.value=!1}))},_e=()=>{"edit"===ie.value&&(re.value=pe.value),ce.value=!1},he=f(null),ke=async e=>ne.value.fields.length<=0?(z({type:"error",message:"请填写至少一个field"}),!1):ne.value.fields.some((e=>e.fieldName===ne.value.structName))?(z({type:"error",message:"存在与结构体同名的字段"}),!1):void he.value.validate((async l=>{var d;if(!l)return!1;for(const e in ne.value)"string"==typeof ne.value[e]&&(ne.value[e]=ne.value[e].trim());if(ne.value.structName=t(ne.value.structName),ne.value.tableName=ne.value.tableName.replace(" ",""),ne.value.tableName||(ne.value.tableName=u(a(ne.value.structName))),ne.value.structName===ne.value.abbreviation)return z({type:"error",message:"structName和struct简称不能相同"}),!1;if(ne.value.humpPackageName=u(ne.value.packageName),e){const e=await o(ne.value);ue.value=e.data.autoCode,ve.value=!0}else{const e=await i(ne.value);if("false"===(null==(d=e.headers)?void 0:d.success))return;if(ne.value.autoMoveFile)return void z({type:"success",message:"自动化代码创建成功，自动移动成功"});z({type:"success",message:"自动化代码创建成功，正在下载"});const l=new Blob([e]),a="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(l),t=document.createElement("a");t.style.display="none",t.href=e,t.setAttribute("download",a),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(l,a)}})),we=f([]),Te=f([]),xe=async()=>{de.value.dbName="",de.value.tableName="";const e=await s({businessDB:de.value.businessDB});0===e.code&&(Te.value=e.data.dbs,we.value=e.data.dbList)},Ce=async()=>{const e=await n({businessDB:de.value.businessDB,dbName:de.value.dbName});0===e.code&&(oe.value=e.data.tables),de.value.tableName=""},Ue=async()=>{const e=["id","created_at","updated_at","deleted_at"],l=await m(de.value);if(0===l.code){let a="";if(""!==de.value.businessDB){const e=we.value.find((e=>e.aliasName===de.value.businessDB));console.log(e);const l=S(e);console.log(l),a=l.dbtype}const u=d(de.value.tableName);ne.value.structName=t(u),ne.value.tableName=de.value.tableName,ne.value.packageName=u,ne.value.abbreviation=u,ne.value.description=u+"表",ne.value.autoCreateApiToSql=!0,ne.value.autoMoveFile=!0,ne.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=d(l.columnName);ne.value.fields.push({fieldName:t(e),fieldDesc:l.columnComment||e+"字段",fieldType:se.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:"oracle"==a?l.columnName.toUpperCase():l.columnName,comment:l.columnComment,require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""})}}))}},Be=async()=>{["string","int","bool","float64","time.Time"].forEach((async e=>{const l=await(async e=>{const l=c();return await l.getDictionary(e),l.dictionaryMap[e]})(e);l&&l.forEach((l=>{se.value[l.label]=e}))}))},De=f([]),Ee=async()=>{const e=await r();0===e.code&&(De.value=e.data.pkgs)},ze=()=>{ae.push({name:"autoPkg"})},Se=()=>{xe(),Be(),Ee();const e=le.params.id;e&&(async e=>{const l=await p({id:Number(e)});0===l.code&&(ne.value=JSON.parse(l.data.meta))})(e)};return Se(),N((()=>le.params.id),(e=>{"autoCodeEdit"===le.name&&Se()})),(t,u)=>{const d=V("pointer"),o=V("el-icon"),i=V("QuestionFilled"),s=V("el-tooltip"),n=V("el-option"),m=V("el-select"),r=V("el-form-item"),p=V("el-button"),c=V("el-form"),v=V("el-collapse-item"),f=V("el-collapse"),b=V("el-input"),g=V("refresh"),y=V("document-add"),N=V("el-checkbox"),z=V("el-table-column"),S=V("el-popover"),q=V("el-table"),J=V("el-dialog");return _(),h("div",null,[k(j,{href:"https://www.bilibili.com/video/BV1kv4y1g7nT?p=3",title:"此功能为开发环境使用，不建议发布到生产，具体使用效果请看视频https://www.bilibili.com/video/BV1kv4y1g7nT?p=3"}),w("div",O,[k(f,{modelValue:te,"onUpdate:modelValue":u[3]||(u[3]=e=>te=e),style:{"margin-bottom":"12px"}},{default:T((()=>[k(v,{name:"1"},{title:T((()=>[w("div",A,[x(" 点这里从现有数据库创建代码 "),k(o,{class:"header-icon"},{default:T((()=>[k(d)])),_:1})])])),default:T((()=>[k(c,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:de.value,"label-width":"120px"},{default:T((()=>[k(r,{label:"业务库",prop:"selectDBtype"},{label:T((()=>[k(s,{content:"注：需要提前到db-list自行配置多数据库，如未配置需配置后重启服务方可使用。（此处可选择对应库表，可理解为从哪个库选择表）",placement:"bottom",effect:"light"},{default:T((()=>[w("div",null,[x(" 业务库 "),k(o,null,{default:T((()=>[k(i)])),_:1})])])),_:1})])),default:T((()=>[k(m,{modelValue:de.value.businessDB,"onUpdate:modelValue":u[0]||(u[0]=e=>de.value.businessDB=e),clearable:"",style:{width:"194px"},placeholder:"选择业务库",onChange:xe},{default:T((()=>[(_(!0),h(C,null,U(we.value,(e=>(_(),B(n,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:T((()=>[w("div",null,[w("span",null,D(e.aliasName),1),w("span",R,D(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(r,{label:"数据库名",prop:"structName"},{default:T((()=>[k(m,{modelValue:de.value.dbName,"onUpdate:modelValue":u[1]||(u[1]=e=>de.value.dbName=e),clearable:"",filterable:"",placeholder:"请选择数据库",onChange:Ce},{default:T((()=>[(_(!0),h(C,null,U(Te.value,(e=>(_(),B(n,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(r,{label:"表名",prop:"structName"},{default:T((()=>[k(m,{modelValue:de.value.tableName,"onUpdate:modelValue":u[2]||(u[2]=e=>de.value.tableName=e),disabled:!de.value.dbName,filterable:"",placeholder:"请选择表"},{default:T((()=>[(_(!0),h(C,null,U(oe.value,(e=>(_(),B(n,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),k(r,null,{default:T((()=>[k(p,{size:"small",type:"primary",onClick:Ue},{default:T((()=>[x("使用此表创建")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),w("div",I,[k(c,{ref_key:"autoCodeForm",ref:he,rules:me.value,model:ne.value,"label-width":"120px",inline:!0},{default:T((()=>[k(r,{label:"Struct名称",prop:"structName"},{default:T((()=>[k(b,{modelValue:ne.value.structName,"onUpdate:modelValue":u[4]||(u[4]=e=>ne.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),k(r,{label:"TableName",prop:"tableName"},{default:T((()=>[k(b,{modelValue:ne.value.tableName,"onUpdate:modelValue":u[5]||(u[5]=e=>ne.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),k(r,{label:"Struct简称",prop:"abbreviation"},{default:T((()=>[k(b,{modelValue:ne.value.abbreviation,"onUpdate:modelValue":u[6]||(u[6]=e=>ne.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),k(r,{label:"Struct中文名称",prop:"description"},{default:T((()=>[k(b,{modelValue:ne.value.description,"onUpdate:modelValue":u[7]||(u[7]=e=>ne.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),k(r,{label:"文件名称",prop:"packageName"},{default:T((()=>[k(b,{modelValue:ne.value.packageName,"onUpdate:modelValue":u[8]||(u[8]=e=>ne.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:u[9]||(u[9]=e=>{var l,t;(l=ne.value)[t="packageName"]=a(l[t])})},null,8,["modelValue"])])),_:1}),k(r,{label:"Package（包）",prop:"package"},{default:T((()=>[k(m,{modelValue:ne.value.package,"onUpdate:modelValue":u[10]||(u[10]=e=>ne.value.package=e),style:{width:"194px"}},{default:T((()=>[(_(!0),h(C,null,U(De.value,(e=>(_(),B(n,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),k(o,{class:"auto-icon",onClick:Ee},{default:T((()=>[k(g)])),_:1}),k(o,{class:"auto-icon",onClick:ze},{default:T((()=>[k(y)])),_:1})])),_:1}),k(r,{label:"业务库",prop:"businessDB"},{label:T((()=>[k(s,{content:"注：需要提前到db-list自行配置多数据库，此项为空则会使用gva本库创建自动化代码(global.GVA_DB),填写后则会创建指定库的代码(global.MustGetGlobalDBByDBName(dbname))",placement:"bottom",effect:"light"},{default:T((()=>[w("div",null,[x(" 业务库 "),k(o,null,{default:T((()=>[k(i)])),_:1})])])),_:1})])),default:T((()=>[k(m,{modelValue:ne.value.businessDB,"onUpdate:modelValue":u[11]||(u[11]=e=>ne.value.businessDB=e),style:{width:"194px"},placeholder:"选择业务库"},{default:T((()=>[(_(!0),h(C,null,U(we.value,(e=>(_(),B(n,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:T((()=>[w("div",null,[w("span",null,D(e.aliasName),1),w("span",M,D(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(r,null,{label:T((()=>[k(s,{content:"注：会自动在结构体添加 created_by updated_by deleted_by，方便用户进行资源权限控制",placement:"bottom",effect:"light"},{default:T((()=>[w("div",null,[x(" 创建资源标识 "),k(o,null,{default:T((()=>[k(i)])),_:1})])])),_:1})])),default:T((()=>[k(N,{modelValue:ne.value.autoCreateResource,"onUpdate:modelValue":u[12]||(u[12]=e=>ne.value.autoCreateResource=e)},null,8,["modelValue"])])),_:1}),k(r,null,{label:T((()=>[k(s,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:T((()=>[W])),_:1})])),default:T((()=>[k(N,{modelValue:ne.value.autoCreateApiToSql,"onUpdate:modelValue":u[13]||(u[13]=e=>ne.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),k(r,null,{label:T((()=>[k(s,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:T((()=>[P])),_:1})])),default:T((()=>[k(N,{modelValue:ne.value.autoMoveFile,"onUpdate:modelValue":u[14]||(u[14]=e=>ne.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),w("div",$,[w("div",X,[k(p,{size:"small",type:"primary",onClick:u[15]||(u[15]=e=>ye())},{default:T((()=>[x("新增Field")])),_:1})]),k(q,{data:ne.value.fields},{default:T((()=>[k(z,{align:"left",type:"index",label:"序列",width:"60"}),k(z,{align:"left",prop:"fieldName",label:"Field名",width:"160"},{default:T((({row:e})=>[k(b,{modelValue:e.fieldName,"onUpdate:modelValue":l=>e.fieldName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"fieldDesc",label:"中文名",width:"160"},{default:T((({row:e})=>[k(b,{modelValue:e.fieldDesc,"onUpdate:modelValue":l=>e.fieldDesc=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"require",label:"必填"},{default:T((({row:e})=>[k(N,{modelValue:e.require,"onUpdate:modelValue":l=>e.require=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"sort",label:"排序"},{default:T((({row:e})=>[k(N,{modelValue:e.sort,"onUpdate:modelValue":l=>e.sort=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"fieldJson",width:"160px",label:"FieldJson"},{default:T((({row:e})=>[k(b,{modelValue:e.fieldJson,"onUpdate:modelValue":l=>e.fieldJson=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"fieldType",label:"Field数据类型",width:"160"},{default:T((({row:e})=>[k(m,{modelValue:e.fieldType,"onUpdate:modelValue":l=>e.fieldType=l,style:{width:"100%"},placeholder:"请选择field数据类型",clearable:""},{default:T((()=>[(_(!0),h(C,null,U(F.value,(e=>(_(),B(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"160"},{default:T((({row:e})=>[k(b,{modelValue:e.dataTypeLong,"onUpdate:modelValue":l=>e.dataTypeLong=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"columnName",label:"数据库字段",width:"160"},{default:T((({row:e})=>[k(b,{modelValue:e.columnName,"onUpdate:modelValue":l=>e.columnName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"comment",label:"数据库字段描述",width:"160"},{default:T((({row:e})=>[k(b,{modelValue:e.columnName,"onUpdate:modelValue":l=>e.columnName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"},{default:T((({row:e})=>[k(m,{modelValue:e.fieldSearchType,"onUpdate:modelValue":l=>e.fieldSearchType=l,style:{width:"100%"},placeholder:"请选择Field查询条件",clearable:""},{default:T((()=>[(_(!0),h(C,null,U(L.value,(l=>(_(),B(n,{key:l.value,label:l.label,value:l.value,disabled:"string"!==e.fieldType&&"LIKE"===l.value||"int"!==e.fieldType&&"time.Time"!==e.fieldType&&"float64"!==e.fieldType&&("BETWEEN"===l.value||"NOT BETWEEN"===l.value)},null,8,["label","value","disabled"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),k(z,{align:"left",label:"操作",width:"300",fixed:"right"},{default:T((e=>[k(p,{size:"small",type:"primary",link:"",icon:"edit",onClick:l=>ye(e.row)},{default:T((()=>[x("高级编辑")])),_:2},1032,["onClick"]),k(p,{size:"small",type:"primary",link:"",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=ne.value.fields[e-1];ne.value.fields.splice(e-1,1),ne.value.fields.splice(e,0,l)})(e.$index)},{default:T((()=>[x("上移")])),_:2},1032,["disabled","onClick"]),k(p,{size:"small",type:"primary",link:"",disabled:e.$index+1===ne.value.fields.length,onClick:l=>(e=>{if(e===ne.value.fields.length-1)return;const l=ne.value.fields[e+1];ne.value.fields.splice(e+1,1),ne.value.fields.splice(e,0,l)})(e.$index)},{default:T((()=>[x("下移")])),_:2},1032,["disabled","onClick"]),k(S,{modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,placement:"top"},{reference:T((()=>[k(p,{size:"small",type:"primary",link:"",icon:"delete",onClick:l=>e.row.visible=!0},{default:T((()=>[x("删除")])),_:2},1032,["onClick"])])),default:T((()=>[G,w("div",K,[k(p,{size:"small",type:"primary",link:"",onClick:l=>e.row.visible=!1},{default:T((()=>[x("取消")])),_:2},1032,["onClick"]),k(p,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void ne.value.fields.splice(a,1);var a}},{default:T((()=>[x("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),w("div",H,[k(p,{size:"small",type:"primary",onClick:u[16]||(u[16]=e=>ke(!0))},{default:T((()=>[x("预览代码")])),_:1}),k(p,{size:"small",type:"primary",onClick:u[17]||(u[17]=e=>ke(!1))},{default:T((()=>[x("生成代码")])),_:1})])]),k(J,{modelValue:ce.value,"onUpdate:modelValue":u[18]||(u[18]=e=>ce.value=e),width:"70%",title:"组件内容"},{footer:T((()=>[w("div",Q,[k(p,{size:"small",onClick:_e},{default:T((()=>[x("取 消")])),_:1}),k(p,{size:"small",type:"primary",onClick:Ve},{default:T((()=>[x("确 定")])),_:1})])])),default:T((()=>[ce.value?(_(),B(e,{key:0,ref:"fieldDialogNode","dialog-middle":re.value},null,8,["dialog-middle"])):E("",!0)])),_:1},8,["modelValue"]),k(J,{modelValue:ve.value,"onUpdate:modelValue":u[20]||(u[20]=e=>ve.value=e)},{header:T((()=>[w("div",Y,[Z,k(p,{size:"small",type:"primary",onClick:be},{default:T((()=>[x("全选")])),_:1}),k(p,{size:"small",type:"primary",onClick:ge},{default:T((()=>[x("复制")])),_:1})])])),footer:T((()=>[w("div",ee,[k(p,{size:"small",type:"primary",onClick:u[19]||(u[19]=e=>ve.value=!1)},{default:T((()=>[x("确 定")])),_:1})])])),default:T((()=>[ve.value?(_(),B(l,{key:0,ref_key:"previewNode",ref:fe,"preview-code":ue.value},null,8,["preview-code"])):E("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-04b94108"]]);export{ae as default};
